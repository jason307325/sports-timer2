<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<title>é¸æ‰‹åˆ†æ®µç§’å·®è¨ˆç®—å™¨ 2026</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0071e3">

<style>
:root{
    --apple-blue:#0071e3;
    --apple-orange:#ff9500;
    --apple-gray:#8e8e93;
    --apple-bg:#f2f2f7;
}
html,body{
    margin:0;padding:0;height:100%;
    background:var(--apple-bg);
    touch-action:manipulation;
    user-select:none;
    overscroll-behavior:none;
}
body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    display:flex;justify-content:center;
}
.container{
    width:100%;max-width:500px;height:100svh;
    background:#fff;display:flex;flex-direction:column;
    padding:8px 12px env(safe-area-inset-bottom);
    box-sizing:border-box;
}
header{text-align:center}
h2{margin:2px 0;font-size:16px}
.hint-text{font-size:11px;color:var(--apple-blue)}

.input-section{
    border:1.5px solid #e5e5ea;border-radius:10px;
    padding:8px;margin-bottom:6px;
}
.status-badge{
    font-size:10px;padding:2px 6px;border-radius:4px;
    background:var(--apple-gray);color:#fff;
    display:inline-block;margin-bottom:4px;
}
.status-badge.edit{background:var(--apple-orange)}

.time-box{
    display:flex;justify-content:center;align-items:center;
    font-size:26px;font-variant-numeric:tabular-nums;
}
.time{
    width:60px;height:48px;line-height:48px;
    text-align:center;border:2px solid #d1d1d6;
    border-radius:10px;background:#fff;
}
.time.active{border-color:var(--apple-blue);background:#eef3ff}
.time.will-replace{color:var(--apple-orange);background:#fff9f0}
.sep{margin:0 4px;color:#aaa;font-size:20px}

.table-container{
    flex:1;overflow-y:auto;
    border:1px solid #e5e5ea;border-radius:8px;
    margin-bottom:6px;
}
table{width:100%;border-collapse:collapse}
th{
    font-size:11px;background:#f9f9f9;
    position:sticky;top:0;
}
td{
    font-size:13px;padding:8px 2px;
    border-bottom:1px solid #f2f2f7;
    text-align:center;
}
.time-cell{
    color:var(--apple-blue);
    font-weight:600;text-decoration:underline;
}
.diff-plus{color:#ff3b30;font-weight:bold}
.diff-minus{color:#34c759;font-weight:bold}

.actions{display:flex;gap:6px;margin-bottom:6px}
.actions button{
    flex:1;padding:10px;border:none;
    border-radius:8px;font-size:14px;font-weight:bold;
}
.btn-main{background:var(--apple-blue);color:#fff}
.btn-main.is-edit{background:var(--apple-orange)}
.btn-clear{background:var(--apple-gray);color:#fff}

.keypad{
    display:grid;grid-template-columns:repeat(3,1fr);gap:6px;
}
.keypad button{
    font-size:20px;padding:10px 0;
    border:none;border-radius:10px;background:#e5e5ea;
}
.keypad .delete{background:#ff3b30;color:#fff}
.keypad .action{background:var(--apple-blue);color:#fff}
</style>
</head>

<body>
<div class="container">

<header>
    <h2>ğŸŠ åˆ†æ®µç§’å·®è¨ˆç®—å™¨</h2>
    <div class="hint-text">é»æ“Šè¡¨æ ¼ã€Œç¸½æ™‚é–“ã€å¯ç›´æ¥ä¿®æ­£</div>
</header>

<div class="input-section">
    <div id="status" class="status-badge">æ–°å¢æ¨¡å¼</div>
    <div class="time-box">
        <div id="min" class="time">00</div><span class="sep">:</span>
        <div id="sec" class="time">00</div><span class="sep">.</span>
        <div id="ms" class="time">00</div>
    </div>
</div>

<div class="table-container">
<table>
<thead>
<tr>
<th>æ®µæ¬¡</th><th>ç¸½æ™‚é–“</th><th>åˆ†æ®µ</th><th>ç§’å·®</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div class="actions">
<button id="save" class="btn-main">âœ“ æ–°å¢ç´€éŒ„</button>
<button id="clear" class="btn-clear">ğŸ—‘ æ¸…é™¤</button>
</div>

<div class="keypad" id="keypad">
<button data="7">7</button><button data="8">8</button><button data="9">9</button>
<button data="4">4</button><button data="5">5</button><button data="6">6</button>
<button data="1">1</button><button data="2">2</button><button data="3">3</button>
<button class="delete" data="del">âŒ«</button><button data="0">0</button>
<button class="action" data="save">âœ“</button>
</div>

</div>

<script>
const fields=["min","sec","ms"];
let idx=0,records=[],edit=null,first=true;

const $=id=>document.getElementById(id);
const bind=(el,fn)=>{
    el.addEventListener("touchstart",e=>{e.preventDefault();fn();},{passive:false});
    el.addEventListener("click",fn);
};

fields.forEach((f,i)=>bind($(f),()=>{idx=i;first=true;hl()}));

document.querySelectorAll("#keypad button").forEach(b=>{
    bind(b,()=>{
        const v=b.getAttribute("data");
        if(v==="del") del();
        else if(v==="save") save();
        else num(v);
    });
});

bind($("save"),save);
bind($("clear"),()=>{if(confirm("ç¢ºå®šæ¸…é™¤ï¼Ÿ")){records=[];edit=null;draw();clr();}});

function hl(){
    fields.forEach((f,i)=>{
        $(f).className="time"+(i===idx?" active":"")+(i===idx&&first?" will-replace":"");
    });
}

function num(n){
    const f=$(fields[idx]);
    f.textContent=first?n:f.textContent+n;
    first=false;
    if(f.textContent.length===2){idx=(idx+1)%3;first=true;}
    hl();
}

function del(){ $(fields[idx]).textContent="00"; first=true; hl(); }

function save(){
    const t=+$("min").textContent*60 + +$("sec").textContent + +$("ms").textContent/100;
    if(!t) return;
    if(edit){edit.total=t;edit=null;}
    else records.push({id:Date.now(),total:t});
    draw(); clr();
}

/* âœ… å·²ä¿®æ­£çš„ç§’å·®è¨ˆç®— */
function draw(){
    records.sort((a,b)=>a.total-b.total);
    $("tbody").innerHTML="";

    records.forEach((r,i)=>{
        const split = i===0 ? r.total : r.total - records[i-1].total;

        let diffText="-", diffClass="";
        if(i>=2){
            const prevSplit = records[i-1].total - records[i-2].total;
            const diff = split - prevSplit;
            diffText = (diff>0?"+":"") + diff.toFixed(2);
            diffClass = diff>0 ? "diff-plus" : "diff-minus";
        }

        const tr=document.createElement("tr");
        tr.innerHTML=`
        <td>${i+1}</td>
        <td class="time-cell">${fmt(r.total)}</td>
        <td>${fmt(split)}</td>
        <td class="${diffClass}">${diffText}</td>
        `;
        bind(tr.querySelector(".time-cell"),()=>{edit=r;load(r);});
        $("tbody").appendChild(tr);
    });
}

function load(r){
    $("min").textContent=Math.floor(r.total/60).toString().padStart(2,"0");
    $("sec").textContent=Math.floor(r.total%60).toString().padStart(2,"0");
    $("ms").textContent=Math.round(r.total%1*100).toString().padStart(2,"0");
    idx=0;first=true;hl();
}

function fmt(s){
    const m=Math.floor(s/60);
    const ss=(s%60).toFixed(2).padStart(5,"0");
    return `${m.toString().padStart(2,"0")}:${ss}`;
}

function clr(){
    fields.forEach(f=>$(f).textContent="00");
    idx=0;first=true;hl();
}

hl();
</script>

<script>
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
