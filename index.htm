<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>游泳教練實戰工作台｜最終穩定版</title>

<style>
:root{
    --bg:#0b0f14;
    --panel:#111823;
    --line:#1f2a3a;
    --txt:#e6ecf3;
    --sub:#8fa2c0;
    --blue:#3fa9ff;
    --red:#ff6b6b;
    --green:#2ed573;
}

*{box-sizing:border-box}

body{
    margin:0;
    background:var(--bg);
    color:var(--txt);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

.container{
    max-width:900px;
    margin:auto;
    padding:14px;
}

h2{
    margin:12px 0 6px;
    font-size:18px;
}

.panel{
    background:var(--panel);
    border-radius:14px;
    padding:14px;
    margin-bottom:16px;
}

input{
    width:100%;
    padding:12px;
    font-size:16px;
    border:none;
    border-radius:10px;
    background:#0f1520;
    color:var(--txt);
}

.btn-row{
    display:flex;
    gap:10px;
    margin-top:10px;
    flex-wrap:wrap;
}

.btn{
    padding:10px 14px;
    border:none;
    border-radius:10px;
    font-size:15px;
    color:#fff;
    background:var(--blue);
}

.btn.gray{background:#2a3444}
.btn.red{background:var(--red)}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th,td{
    padding:8px;
    font-size:14px;
    text-align:center;
    border-bottom:1px solid var(--line);
}

th{color:var(--sub)}

.diff-up{color:var(--red);font-weight:600}
.diff-down{color:var(--green);font-weight:600}

.btn-del{
    width:26px;
    height:26px;
    border-radius:50%;
    border:none;
    background:#263042;
    color:#fff;
}
</style>
</head>

<body>
<div class="container">

<!-- 手動輸入 -->
<h2>手動輸入</h2>
<div class="panel">
    <input id="manualInput" placeholder="輸入總秒數（例：75.32）">
    <div class="btn-row">
        <button class="btn" onclick="addManual()">新增</button>
        <button class="btn red" onclick="clearManual()">清空</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>總秒</th>
                <th>分段</th>
                <th>秒差</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="manualBody"></tbody>
    </table>
</div>

<!-- 碼錶 -->
<h2>碼錶</h2>
<div class="panel">
    <div id="swDisplay"
         style="font-size:28px;text-align:center;margin-bottom:10px">
        0.00
    </div>

    <div class="btn-row">
        <button class="btn" onclick="swStart()">Start</button>
        <button class="btn gray" onclick="swLap()">Lap</button>
        <button class="btn red" onclick="swStop()">Stop</button>
        <button class="btn gray" onclick="swReset()">Reset</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>總秒</th>
                <th>分段</th>
                <th>秒差</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="swBody"></tbody>
    </table>
</div>

</div>

<script>
/* ========= 共用工具 ========= */
const fmt = v => v.toFixed(2);

/* ========= 核心渲染（秒差已完整修正） ========= */
function render(data, bodyId, delFn){
    const body = document.getElementById(bodyId);

    if(!data.length){
        body.innerHTML =
          `<tr><td colspan="5" style="padding:30px;color:#555">無紀錄</td></tr>`;
        return;
    }

    body.innerHTML = data.map((d,i)=>{
        const prevTotal = i > 0 ? data[i-1].total : 0;
        const lap = d.total - prevTotal;

        let diffText = "—";
        let diffClass = "";

        if(i > 1){
            const prevLap =
                data[i-1].total - data[i-2].total;
            const diff = lap - prevLap;
            diffText =
                (diff > 0 ? "+" : "") + diff.toFixed(2);
            diffClass =
                diff > 0 ? "diff-up" : "diff-down";
        }

        return `
        <tr>
            <td>${i+1}</td>
            <td>${fmt(d.total)}</td>
            <td>${fmt(lap)}</td>
            <td class="${diffClass}">${diffText}</td>
            <td>
                <button class="btn-del"
                    onclick="${delFn}(${d.id})">−</button>
            </td>
        </tr>`;
    }).join("");
}

/* ========= 手動 ========= */
let manualData = [];
let mid = 0;

function addManual(){
    const v = parseFloat(manualInput.value);
    if(isNaN(v)) return;
    manualData.push({id:mid++, total:v});
    manualInput.value = "";
    render(manualData,"manualBody","delManual");
}

function delManual(id){
    manualData = manualData.filter(d=>d.id!==id);
    render(manualData,"manualBody","delManual");
}

function clearManual(){
    manualData = [];
    render(manualData,"manualBody","delManual");
}

/* ========= 碼錶 ========= */
let swData = [];
let swId = 0;
let timer = null;
let startT = 0;

function swStart(){
    if(timer) return;
    startT = performance.now() -
        (swData.length ? swData.at(-1).total*1000 : 0);

    timer = setInterval(()=>{
        const t = (performance.now()-startT)/1000;
        swDisplay.textContent = fmt(t);
    },30);
}

function swLap(){
    if(!timer) return;
    const t = (performance.now()-startT)/1000;
    swData.push({id:swId++, total:t});
    render(swData,"swBody","delSw");
}

function swStop(){
    clearInterval(timer);
    timer = null;
}

function swReset(){
    swStop();
    swData = [];
    swDisplay.textContent = "0.00";
    render(swData,"swBody","delSw");
}

function delSw(id){
    swData = swData.filter(d=>d.id!==id);
    render(swData,"swBody","delSw");
}
</script>
</body>
</html>
