<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é¸æ‰‹åˆ†æ®µç§’å·®è¨ˆç®—å™¨ 2026</title>
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0071e3">
    <style>
        :root {
            --apple-blue: #0071e3;
            --apple-orange: #ff9500;
            --apple-gray: #8e8e93;
            --apple-bg: #f2f2f7;
        }

        html, body {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            height: 100%;
            background: var(--apple-bg);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            height: 100svh; 
            background: #fff;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            padding: 8px 12px env(safe-area-inset-bottom);
        }

        header { text-align: center; padding: 2px 0; }
        h2 { margin: 2px 0; font-size: 16px; color: #1c1c1e; }
        .hint-text { font-size: 11px; color: var(--apple-blue); margin-bottom: 5px; font-weight: 500; }

        .input-section {
            background: #ffffff;
            padding: 8px;
            border-radius: 10px;
            border: 1.5px solid #e5e5ea;
            margin-bottom: 6px;
        }
        .status-badge {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 4px;
            background: var(--apple-gray);
            color: white;
        }
        .status-badge.edit { background: var(--apple-orange); }

        .time-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 26px;
            font-variant-numeric: tabular-nums;
        }
        .time {
            width: 60px;
            height: 48px;
            line-height: 48px;
            text-align: center;
            border: 2px solid #d1d1d6;
            border-radius: 10px;
            background: white;
            transition: all 0.2s;
        }
        .time.active { 
            border-color: var(--apple-blue); 
            background: #eef3ff;
            box-shadow: 0 0 0 3px rgba(0,113,227,0.1);
        }
        /* ä¿®æ”¹ä¸­çš„è¦–è¦ºæç¤º */
        .time.will-replace {
            color: var(--apple-orange);
            background: #fff9f0;
        }
        .sep { margin: 0 4px; font-weight: bold; color: #aeaeb2; font-size: 20px; }

        .table-container {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #e5e5ea;
            border-radius: 8px;
            margin-bottom: 6px;
        }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f9f9f9; color: #8e8e93; font-size: 11px; padding: 6px 2px; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #eee; }
        td { padding: 8px 2px; text-align: center; border-bottom: 1px solid #f2f2f7; font-size: 13px; }
        
        .time-cell {
            font-size: 14px;
            font-weight: 600;
            color: var(--apple-blue);
            text-decoration: underline;
        }
        tr.is-editing { background-color: #fff9f0 !important; }

        .diff-plus { color: #ff3b30; font-weight: bold; }
        .diff-minus { color: #34c759; font-weight: bold; }

        .actions { display: flex; gap: 6px; margin-bottom: 6px; }
        .actions button {
            flex: 1; padding: 10px; border: none; border-radius: 8px;
            font-size: 14px; font-weight: bold;
        }
        .btn-main { background: var(--apple-blue); color: #fff; }
        .btn-main.is-edit { background: var(--apple-orange); }
        .btn-clear { background: var(--apple-gray); color: #fff; }

        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .keypad button {
            font-size: 20px;
            padding: 10px 0;
            border: none; border-radius: 10px;
            background: #e5e5ea; color: #1c1c1e; font-weight: 500;
        }
        .keypad button:active { background: #c7c7cc; }
        .keypad .action { background: var(--apple-blue); color: #fff; }
        .keypad .delete { background: #ff3b30; color: #fff; }
    </style>
</head>

<body>
<div class="container">
    <header>
        <h2>ğŸŠ åˆ†æ®µç§’å·®è¨ˆç®—å™¨</h2>
        <div class="hint-text">ğŸ’¡ ä¿®æ­£æ™‚é–“ï¼šé»æ“Šè¡¨æ ¼ã€Œç¸½æ™‚é–“ã€ç›´æ¥æ‰“æ•¸å­—è¦†è“‹</div>
    </header>

    <div class="input-section" id="input-ui">
        <div id="status-badge" class="status-badge">æ–°å¢æ¨¡å¼</div>
        <div class="time-box">
            <div id="min" class="time">00</div><span class="sep">:</span>
            <div id="sec" class="time">00</div><span class="sep">.</span>
            <div id="ms" class="time">00</div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th width="15%">æ®µæ¬¡</th>
                    <th width="35%">ç¸½æ™‚é–“ (ä¿®æ­£)</th>
                    <th width="25%">åˆ†æ®µ</th>
                    <th width="25%">ç§’å·®</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <div class="actions">
        <button class="btn-main" id="btn-save">âœ“ æ–°å¢ç´€éŒ„</button>
        <button class="btn-clear" id="btn-clear">ğŸ—‘ æ¸…é™¤</button>
    </div>

    <div class="keypad" id="keypad">
        <button data-val="7">7</button><button data-val="8">8</button><button data-val="9">9</button>
        <button data-val="4">4</button><button data-val="5">5</button><button data-val="6">6</button>
        <button data-val="1">1</button><button data-val="2">2</button><button data-val="3">3</button>
        <button class="delete" data-val="del">âŒ«</button><button data-val="0">0</button><button class="action" data-val="save">âœ“</button>
    </div>
</div>

<script>
const fields = ["min", "sec", "ms"];
let currentIdx = 0;
let records = [];
let editingId = null;
let isFirstKeyInField = true; // è¿½è¹¤æ˜¯å¦ç‚ºè©²æ ¼çš„ç¬¬ä¸€å€‹æ•¸å­—ï¼Œç”¨æ–¼ã€Œç›´æ¥è¦†è“‹ã€

const tbody = document.getElementById("tbody");
const btnSave = document.getElementById('btn-save');
const statusBadge = document.getElementById('status-badge');

function bind(el, cb) {
    el.addEventListener('touchstart', (e) => { e.preventDefault(); cb(); }, { passive: false });
    el.addEventListener('click', cb);
}

fields.forEach((id, idx) => {
    bind(document.getElementById(id), () => { 
        currentIdx = idx; 
        isFirstKeyInField = true; // é»æ“ŠæŸæ ¼å¾Œï¼Œä¸‹æ¬¡æŒ‰æ•¸å­—æœƒè¦†è“‹
        highlight(); 
    });
});

document.querySelectorAll('#keypad button').forEach(btn => {
    bind(btn, () => {
        const val = btn.getAttribute('data-val');
        if (val === 'del') backspace();
        else if (val === 'save') saveRecord();
        else inputNum(val);
    });
});

bind(btnSave, saveRecord);
bind(document.getElementById('btn-clear'), clearAll);

function highlight() {
    fields.forEach((id, idx) => {
        const el = document.getElementById(id);
        el.classList.remove("active", "will-replace");
        if(idx === currentIdx) {
            el.classList.add("active");
            if(isFirstKeyInField) el.classList.add("will-replace");
        }
    });
}

function inputNum(n) {
    let f = document.getElementById(fields[currentIdx]);
    
    if (isFirstKeyInField) {
        // ç›´æ¥è¦†è“‹èˆŠæ•¸å­—
        f.textContent = n;
        isFirstKeyInField = false;
    } else {
        // è¼¸å…¥ç¬¬äºŒå€‹æ•¸å­—
        if (f.textContent.length < 2) {
            f.textContent += n;
        }
    }

    // åªè¦æ»¿å…©ä½æ•¸ï¼Œè‡ªå‹•è·³ä¸‹ä¸€æ ¼ä¸¦è¨­å®šç‚ºã€Œå¾…è¦†è“‹ã€ç‹€æ…‹
    if (f.textContent.length === 2) {
        currentIdx = (currentIdx + 1) % 3;
        isFirstKeyInField = true;
        highlight();
    } else {
        highlight();
    }
}

function backspace() {
    let f = document.getElementById(fields[currentIdx]);
    f.textContent = "00";
    isFirstKeyInField = true;
    highlight();
}

function saveRecord() {
    const total = (parseInt(document.getElementById("min").textContent) * 60) + 
                  (parseInt(document.getElementById("sec").textContent)) + 
                  (parseInt(document.getElementById("ms").textContent) / 100);
    if (total === 0) return;

    if (editingId !== null) {
        const item = records.find(r => r.id === editingId);
        if (item) item.total = total;
        exitEditMode();
    } else {
        records.push({ id: Date.now(), total: total });
    }

    refreshUI();
    clearInput();
}

function refreshUI() {
    records.sort((a, b) => a.total - b.total);
    tbody.innerHTML = "";
    records.forEach((r, i) => {
        r.split = (i === 0) ? r.total : r.total - records[i - 1].total;
        let diff = "-", cls = "";
        if (i > 0) {
            let d = r.split - records[i - 1].split;
            diff = (d > 0 ? "+" : "") + d.toFixed(2) + "s";
            cls = d > 0 ? "diff-plus" : "diff-minus";
        }
        const tr = document.createElement("tr");
        if (editingId === r.id) tr.className = "is-editing";
        tr.innerHTML = `<td>${i + 1}</td><td class="time-cell">${format(r.total)}</td><td>${format(r.split)}</td><td class="${cls}">${diff}</td>`;
        bind(tr.querySelector('.time-cell'), () => enterEditMode(r));
        tbody.appendChild(tr);
    });
}

function enterEditMode(record) {
    editingId = record.id;
    const m = Math.floor(record.total / 60);
    const s = Math.floor(record.total % 60);
    const ms = Math.round((record.total % 1) * 100);
    
    document.getElementById("min").textContent = m.toString().padStart(2, "0");
    document.getElementById("sec").textContent = s.toString().padStart(2, "0");
    document.getElementById("ms").textContent = ms.toString().padStart(2, "0");
    
    statusBadge.textContent = "ç·¨è¼¯æ¨¡å¼";
    statusBadge.classList.add("edit");
    btnSave.textContent = "ğŸ’¾ å„²å­˜ä¿®æ”¹";
    btnSave.classList.add("is-edit");
    
    currentIdx = 0;
    isFirstKeyInField = true; // é€²å…¥ç·¨è¼¯æ¨¡å¼ï¼Œé»ç¬¬ä¸€æ ¼æ™‚ç›´æ¥è¦†è“‹
    highlight();
    refreshUI();
}

function exitEditMode() {
    editingId = null;
    statusBadge.textContent = "æ–°å¢æ¨¡å¼";
    statusBadge.classList.remove("edit");
    btnSave.textContent = "âœ“ æ–°å¢ç´€éŒ„";
    btnSave.classList.remove("is-edit");
}

function format(sec) {
    let m = Math.floor(sec / 60);
    let s = (sec % 60).toFixed(2);
    return `${m.toString().padStart(2, "0")}:${s.padStart(5, "0")}`;
}

function clearInput() {
    fields.forEach(id => document.getElementById(id).textContent = "00");
    currentIdx = 0;
    isFirstKeyInField = true;
    highlight();
}

function clearAll() {
    if (confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
        records = [];
        exitEditMode();
        refreshUI();
        clearInput();
    }
}
highlight();
</script>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
}
</script>
</body>
</html>
