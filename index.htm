<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¸æ‰‹åˆ†æ®µç§’å·®è¨ˆç®—å™¨ 2026</title>
    <style>
        html, body {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f2f2f7;
            padding: 10px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: #fff;
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,.1);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* --- è¼¸å…¥å€ï¼šæ›´ç²¾ç·»çš„æŒ‡ç¤ºå™¨ --- */
        .input-section {
            background: #ffffff;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 2px solid #e5e5ea;
            transition: all 0.3s ease;
        }
        .input-section.editing-active {
            border-color: #ff9500;
            background: #fff9f0;
        }
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            background: #8e8e93;
            color: white;
        }
        .status-badge.edit { background: #ff9500; }

        .time-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 26px;
            font-variant-numeric: tabular-nums;
        }
        .time {
            width: 60px;
            text-align: center;
            border: 2px solid #d1d1d6;
            border-radius: 8px;
            padding: 4px;
            background: white;
        }
        .time.active {
            border-color: #0071e3;
            background: #eef3ff;
            box-shadow: 0 0 0 2px rgba(0,113,227,0.2);
        }
        .sep { margin: 0 4px; font-weight: bold; color: #aeaeb2; }

        /* --- ç´€éŒ„è¡¨æ ¼ï¼šå¢åŠ ç·¨è¼¯ç‹€æ…‹æ¨£å¼ --- */
        .table-container {
            flex-grow: 1;
            min-height: 220px;
            max-height: 320px;
            overflow-y: auto;
            margin-bottom: 12px;
            border: 1px solid #e5e5ea;
            border-radius: 10px;
        }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f9f9f9; color: #8e8e93; font-size: 13px; padding: 10px 5px; position: sticky; top: 0; }
        td { padding: 12px 5px; text-align: center; border-bottom: 1px solid #f2f2f7; font-size: 14px; }
        
        /* é»æ“Šç¸½æ™‚é–“çš„è§¸ç™¼æ¨£å¼ */
        .time-cell {
            font-size: 16px;
            font-weight: 600;
            color: #0071e3;
            cursor: pointer;
            background: #f8fbff;
            border-radius: 6px;
        }
        tr.is-editing { background-color: #fff9f0 !important; }
        tr.is-editing .time-cell { color: #ff9500; }

        .diff-plus { color: #ff3b30; font-weight: bold; }
        .diff-minus { color: #34c759; font-weight: bold; }

        /* --- æ“ä½œå€ --- */
        .actions { display: flex; gap: 10px; margin-bottom: 10px; }
        .actions button {
            flex: 1; padding: 14px; border: none; border-radius: 12px;
            font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .btn-main { background: #0071e3; color: #fff; }
        .btn-main.is-edit { background: #ff9500; }
        .btn-clear { background: #8e8e93; color: #fff; font-size: 14px; }

        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .keypad button {
            font-size: 26px; padding: 16px 0; border: none; border-radius: 14px;
            background: #e5e5ea; color: #1c1c1e; font-weight: 500;
        }
        .keypad button:active { background: #c7c7cc; }
        .keypad .action { background: #0071e3; color: #fff; }
        .keypad .delete { background: #ff3b30; color: #fff; }
    </style>
</head>

<body>
<div class="container">
    <div class="input-section" id="input-ui">
        <div id="status-badge" class="status-badge">æ–°å¢æ¨¡å¼</div>
        <div class="time-box">
            <div id="min" class="time">00</div><span class="sep">:</span>
            <div id="sec" class="time">00</div><span class="sep">.</span>
            <div id="ms" class="time">00</div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>æ®µæ¬¡</th>
                    <th>ç¸½æ™‚é–“ (é»æ“Šä¿®æ”¹)</th>
                    <th>åˆ†æ®µ</th>
                    <th>ç§’å·®</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <div class="actions">
        <button class="btn-main" id="btn-save">âœ“ æ–°å¢ç´€éŒ„</button>
        <button class="btn-clear" id="btn-clear">ğŸ—‘ å…¨éƒ¨æ¸…é™¤</button>
    </div>

    <div class="keypad" id="keypad">
        <button data-val="7">7</button><button data-val="8">8</button><button data-val="9">9</button>
        <button data-val="4">4</button><button data-val="5">5</button><button data-val="6">6</button>
        <button data-val="1">1</button><button data-val="2">2</button><button data-val="3">3</button>
        <button class="delete" data-val="del">âŒ«</button><button data-val="0">0</button><button class="action" data-val="save">âœ“</button>
    </div>
</div>

<script>
const fields = ["min", "sec", "ms"];
let currentIdx = 0;
let records = [];
let editingId = null; // å„²å­˜æ­£åœ¨ç·¨è¼¯çš„ç´€éŒ„å”¯ä¸€æ¨™è¨˜

const tbody = document.getElementById("tbody");
const btnSave = document.getElementById('btn-save');
const inputUI = document.getElementById('input-ui');
const statusBadge = document.getElementById('status-badge');

function bind(el, cb) {
    el.addEventListener('touchstart', (e) => { e.preventDefault(); cb(); }, { passive: false });
    el.addEventListener('click', cb);
}

// åˆå§‹åŒ–æ¬„ä½é»æ“Š
fields.forEach((id, idx) => {
    bind(document.getElementById(id), () => { currentIdx = idx; highlight(); });
});

// åˆå§‹åŒ–éµç›¤
document.querySelectorAll('#keypad button').forEach(btn => {
    bind(btn, () => {
        const val = btn.getAttribute('data-val');
        if (val === 'del') backspace();
        else if (val === 'save') saveRecord();
        else inputNum(val);
    });
});

bind(btnSave, saveRecord);
bind(document.getElementById('btn-clear'), clearAll);

function highlight() {
    fields.forEach(id => document.getElementById(id).classList.remove("active"));
    document.getElementById(fields[currentIdx]).classList.add("active");
}

function inputNum(n) {
    let f = document.getElementById(fields[currentIdx]);
    // ç‚ºäº†ç›´è¦ºï¼Œå¦‚æœåŸæœ¬æ˜¯ 00 æˆ–æ˜¯å‰›åˆ‡æ›æ¬„ä½ï¼Œç›´æ¥æ›¿æ›æ•¸å­—
    if (f.textContent === "00") f.textContent = "";
    if (f.textContent.length < 2) {
        f.textContent += n;
        if (f.textContent.length === 2 && currentIdx < 2) {
            currentIdx++;
            highlight();
        }
    }
}

function backspace() {
    let f = document.getElementById(fields[currentIdx]);
    if (f.textContent !== "00" && f.textContent.length > 0) {
        f.textContent = f.textContent.slice(0, -1);
        if (f.textContent === "") f.textContent = "00";
    } else if (currentIdx > 0) {
        currentIdx--;
        highlight();
    }
}

function saveRecord() {
    const total = (parseInt(document.getElementById("min").textContent) * 60) + 
                  (parseInt(document.getElementById("sec").textContent)) + 
                  (parseInt(document.getElementById("ms").textContent) / 100);
    if (total === 0) return;

    if (editingId !== null) {
        // ä¿®æ”¹æ¨¡å¼ï¼šæ‰¾åˆ°è©²ç­†è³‡æ–™æ›´æ–°
        const item = records.find(r => r.id === editingId);
        if (item) item.total = total;
        exitEditMode();
    } else {
        // æ–°å¢æ¨¡å¼
        records.push({ id: Date.now(), total: total });
    }

    refreshUI();
    clearInput();
}

function refreshUI() {
    // ä¾ç¸½æ™‚é–“æ­£åºæ’åº (æ ¸å¿ƒï¼šä¿®æ”¹å¾Œå¯èƒ½é †åºæœƒè®Šï¼Œé€™è£¡è‡ªå‹•è™•ç†)
    records.sort((a, b) => a.total - b.total);

    tbody.innerHTML = "";
    records.forEach((r, i) => {
        r.split = (i === 0) ? r.total : r.total - records[i - 1].total;
        let diff = "-", cls = "";
        if (i > 0) {
            let d = r.split - (records[i - 1].split);
            diff = (d > 0 ? "+" : "") + d.toFixed(2) + "s";
            cls = d > 0 ? "diff-plus" : "diff-minus";
        }

        const tr = document.createElement("tr");
        if (editingId === r.id) tr.className = "is-editing";
        
        tr.innerHTML = `
            <td>${i + 1}</td>
            <td class="time-cell">${format(r.total)} ${editingId === r.id ? 'âœï¸' : ''}</td>
            <td>${format(r.split)}</td>
            <td class="${cls}">${diff}</td>
        `;

        // é»æ“Šç¸½æ™‚é–“é€²å…¥ç·¨è¼¯
        bind(tr.querySelector('.time-cell'), () => enterEditMode(r));
        tbody.appendChild(tr);
    });
}

function enterEditMode(record) {
    editingId = record.id;
    const m = Math.floor(record.total / 60);
    const s = Math.floor(record.total % 60);
    const ms = Math.round((record.total % 1) * 100);

    document.getElementById("min").textContent = m.toString().padStart(2, "0");
    document.getElementById("sec").textContent = s.toString().padStart(2, "0");
    document.getElementById("ms").textContent = ms.toString().padStart(2, "0");

    statusBadge.textContent = "ç·¨è¼¯æ¨¡å¼";
    statusBadge.classList.add("edit");
    inputUI.classList.add("editing-active");
    btnSave.textContent = "ğŸ’¾ å„²å­˜ä¿®æ”¹";
    btnSave.classList.add("is-edit");
    
    currentIdx = 1; // é è¨­è·³åˆ°ã€Œç§’ã€ï¼Œé€šå¸¸ä¿®æ”¹ç§’æ•¸æœ€é »ç¹
    highlight();
    refreshUI();
}

function exitEditMode() {
    editingId = null;
    statusBadge.textContent = "æ–°å¢æ¨¡å¼";
    statusBadge.classList.remove("edit");
    inputUI.classList.remove("editing-active");
    btnSave.textContent = "âœ“ æ–°å¢ç´€éŒ„";
    btnSave.classList.remove("is-edit");
}

function format(sec) {
    let m = Math.floor(sec / 60);
    let s = (sec % 60).toFixed(2);
    return `${m.toString().padStart(2, "0")}:${s.padStart(5, "0")}`;
}

function clearInput() {
    fields.forEach(id => document.getElementById(id).textContent = "00");
    currentIdx = 1; // å›åˆ°ç§’ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è¼¸å…¥
    highlight();
}

function clearAll() {
    if (confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
        records = [];
        exitEditMode();
        refreshUI();
        clearInput();
    }
}

// åˆå§‹é«˜äº®
highlight();
</script>
</body>
</html>
