<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¸æ‰‹åˆ†æ®µç§’å·®è¨ˆç®—å™¨</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0071e3">

    <style>
        html, body {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none; /* é˜²æ­¢ä¸‹æ‹‰é‡æ–°æ•´ç†å½±éŸ¿æ“ä½œ */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f7;
            padding: 10px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: #fff;
            padding: 15px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,.08);
            display: flex;
            flex-direction: column;
        }

        h2 { text-align: center; color: #1d1d1f; margin: 10px 0; font-size: 20px; }

        /* --- 1. æ™‚é–“é¡¯ç¤ºå€åŸŸ --- */
        .time-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            margin-bottom: 15px;
            font-variant-numeric: tabular-nums;
        }

        .time {
            width: 75px;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 10px;
            padding: 5px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .time.active {
            border-color: #0071e3;
            background: #eef3ff;
            box-shadow: 0 0 8px rgba(0,113,227,0.3);
        }

        .sep { margin: 0 4px; font-weight: bold; color: #86868b; }

        /* --- 2. ç´€éŒ„è¡¨æ ¼å€åŸŸ (ç§»è‡³ä¸­é–“) --- */
        .table-container {
            flex-grow: 1;
            max-height: 250px; /* é™åˆ¶é«˜åº¦ï¼Œç¢ºä¿éµç›¤åœ¨è¢å¹•å…§ */
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        th { background: #fafafa; color: #888; position: sticky; top: 0; }

        .diff-plus { color: #d70015; font-weight: bold; }
        .diff-minus { color: #008026; font-weight: bold; }

        /* --- 3. æ§åˆ¶æŒ‰éˆ•èˆ‡éµç›¤ (ç§»è‡³ä¸‹æ–¹) --- */
        .actions {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .add { background: #0071e3; color: #fff; }
        .clear-all { background: #86868b; color: #fff; }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .keypad button {
            font-size: 24px;
            padding: 15px 0;
            border: none;
            border-radius: 12px;
            background: #f2f2f7;
            color: #1d1d1f;
            font-weight: 500;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .keypad button:active { background: #d1d1d6; }
        .keypad .action { background: #0071e3; color: #fff; }
        .keypad .action:active { background: #005bb5; }
        .keypad .delete { background: #ff3b30; color: #fff; }
        .keypad .delete:active { background: #c72c23; }

    </style>
</head>

<body>
<div class="container">
    <h2>ğŸŠ åˆ†æ®µç§’å·®è¨ˆç®—å™¨</h2>

    <!-- 1. ä¸Šæ–¹ï¼šæ™‚é–“è¼¸å…¥é¡¯ç¤º -->
    <div class="time-box">
        <div id="min" class="time">00</div>
        <span class="sep">:</span>
        <div id="sec" class="time">00</div>
        <span class="sep">.</span>
        <div id="ms" class="time">00</div>
    </div>

    <!-- 2. ä¸­é–“ï¼šç´€éŒ„è¡¨æ ¼ -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>æ®µæ¬¡</th>
                    <th>ç¸½æ™‚é–“</th>
                    <th>åˆ†æ®µ</th>
                    <th>ç§’å·®</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <!-- 3. ä¸‹æ–¹ï¼šæ“ä½œæŒ‰éˆ•èˆ‡éµç›¤ -->
    <div class="actions">
        <button class="add" id="btn-add">âœ“ æ–°å¢ç´€éŒ„</button>
        <button class="clear-all" id="btn-clear">ğŸ—‘ æ¸…é™¤</button>
    </div>

    <div class="keypad" id="keypad">
        <button data-val="1">1</button>
        <button data-val="2">2</button>
        <button data-val="3">3</button>
        <button data-val="4">4</button>
        <button data-val="5">5</button>
        <button data-val="6">6</button>
        <button data-val="7">7</button>
        <button data-val="8">8</button>
        <button data-val="9">9</button>
        <button class="delete" data-val="del">âŒ«</button>
        <button data-val="0">0</button>
        <button class="action" data-val="add">âœ“</button>
    </div>
</div>

<script>
const fields = ["min", "sec", "ms"];
let current = 0;
let records = [];
const tbody = document.getElementById("tbody");

// é›¶å»¶é²é»æ“Šæ ¸å¿ƒé‚è¼¯
function bindFastClick(el, callback) {
    el.addEventListener('touchstart', function(e) {
        e.preventDefault();
        callback();
    }, { passive: false });

    el.addEventListener('click', function(e) {
        callback();
    });
}

// åˆå§‹åŒ–æ™‚é–“æ¬„ä½é»æ“Š
fields.forEach((id, idx) => {
    bindFastClick(document.getElementById(id), () => {
        current = idx;
        highlight();
    });
});

// åˆå§‹åŒ–æ•¸å­—éµç›¤
document.querySelectorAll('#keypad button').forEach(btn => {
    bindFastClick(btn, () => {
        const val = btn.getAttribute('data-val');
        if (val === 'del') backspace();
        else if (val === 'add') addRecord();
        else inputNum(val);
    });
});

// åˆå§‹åŒ–åŠŸèƒ½æŒ‰éˆ•
bindFastClick(document.getElementById('btn-add'), addRecord);
bindFastClick(document.getElementById('btn-clear'), clearAll);

function highlight() {
    fields.forEach(id => document.getElementById(id).classList.remove("active"));
    document.getElementById(fields[current]).classList.add("active");
}

function inputNum(n) {
    let f = document.getElementById(fields[current]);
    if (f.textContent === "00") f.textContent = "";
    if (f.textContent.length < 2) {
        f.textContent += n;
        if (f.textContent.length === 2 && current < 2) {
            current++;
            highlight();
        }
    }
}

function backspace() {
    let f = document.getElementById(fields[current]);
    if (f.textContent !== "00" && f.textContent.length > 0) {
        f.textContent = f.textContent.slice(0, -1);
        if (f.textContent === "") f.textContent = "00";
    } else if (current > 0) {
        current--;
        highlight();
    }
}

function addRecord() {
    const total = (parseInt(document.getElementById("min").textContent) * 60) + 
                  (parseInt(document.getElementById("sec").textContent)) + 
                  (parseInt(document.getElementById("ms").textContent) / 100);

    if (total === 0) return;
    
    let split = total;
    if (records.length > 0) {
        split = total - records[records.length - 1].total;
    }

    if (split < 0) {
        alert("éŒ¯èª¤ï¼šç¸½æ™‚é–“ä¸å¯ä½æ–¼å‰ä¸€ç­†ç´€éŒ„");
        return;
    }

    records.push({ total, split });
    updateTable();
    
    // é‡ç½®è¼¸å…¥ï¼Œç„¦é»å›åˆ°ã€Œç§’ã€ä»¥ä¾¿å¿«é€Ÿè¼¸å…¥ä¸‹ä¸€æ®µï¼ˆæˆ–å›åˆ°åˆ†ï¼Œè¦–ç¿’æ…£è€Œå®šï¼‰
    fields.forEach(id => document.getElementById(id).textContent = "00");
    current = 0; 
    highlight();
}

function clearAll() {
    if (confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
        records = [];
        updateTable();
    }
}

function updateTable() {
    tbody.innerHTML = "";
    records.forEach((r, i) => {
        let diff = "-", cls = "";
        if (i > 0) {
            let d = r.split - records[i-1].split;
            diff = (d > 0 ? "+" : "") + d.toFixed(2) + "s";
            cls = d > 0 ? "diff-plus" : "diff-minus";
        }
        
        let m = Math.floor(r.total / 60);
        let s = (r.total % 60).toFixed(2);
        let ts = `${m.toString().padStart(2, "0")}:${s.padStart(5, "0")}`;

        let sm = Math.floor(r.split / 60);
        let ss = (r.split % 60).toFixed(2);
        let ss_str = `${sm.toString().padStart(2, "0")}:${ss.padStart(5, "0")}`;

        const row = `<tr>
            <td>${i + 1}</td>
            <td>${ts}</td>
            <td>${ss_str}</td>
            <td class="${cls}">${diff}</td>
        </tr>`;
        tbody.insertAdjacentHTML('afterbegin', row); // æ–°ç´€éŒ„é¡¯ç¤ºåœ¨æœ€ä¸Šæ–¹
    });
}

highlight();
</script>
</body>
</html>
