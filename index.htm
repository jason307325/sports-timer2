<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>åˆ†æ®µç§’å·®è¨ˆç®—å™¨</title>

<style>
:root{
 --blue:#0071e3;--orange:#ff9500;--gray:#8e8e93;--bg:#f2f2f7;
}
html,body{
 margin:0;height:100%;background:var(--bg);
 user-select:none;touch-action:manipulation;
}
body{
 display:flex;justify-content:center;
 font-family:-apple-system,BlinkMacSystemFont;
}
.container{
 width:100%;max-width:480px;
 min-height:100svh;
 background:#fff;
 display:flex;flex-direction:column;
 padding:
   env(safe-area-inset-top)
   12px
   calc(env(safe-area-inset-bottom) + 8px);
 box-sizing:border-box;
}

/* ===== æŠ¬é ­ ===== */
header{text-align:center;margin-bottom:6px}
header h2{margin:2px 0;font-size:18px}
header .hint{font-size:13px;color:var(--blue)}

/* ===== è¼¸å…¥æ ¼ ===== */
.time-box{
 display:flex;justify-content:center;margin:8px 0;
}
.time{
 width:80px;height:64px;line-height:64px;
 font-size:40px;font-weight:bold;text-align:center;
 border:3px solid #ccc;border-radius:14px;
}
.time.active{border-color:var(--blue);background:#eef3ff}
.sep{margin:0 6px;font-size:30px;color:#aaa}

/* ===== ç¢¼éŒ¶ ===== */
.stopwatch{
 display:flex;gap:6px;margin-bottom:8px;
}
.stopwatch button{
 flex:1;padding:14px;border:none;border-radius:14px;
 font-size:18px;font-weight:bold;
}
.btn-blue{background:var(--blue);color:#fff}
.btn-orange{background:var(--orange);color:#fff}
.btn-gray{background:var(--gray);color:#fff}
button:disabled{opacity:.4}

/* ===== è¡¨æ ¼ï¼ˆ8ç­†é«˜åº¦ï¼‰ ===== */
.table-container{
 height:300px;overflow-y:auto;
 border:1px solid #eee;border-radius:14px;
 margin-bottom:8px;
}
table{width:100%;border-collapse:collapse}
th,td{
 padding:8px 4px;text-align:center;
 font-size:16px;
 border-bottom:1px solid #eee;
}
th{background:#f2f2f7;position:sticky;top:0}
.time-cell{
 color:var(--blue);font-weight:800;
 text-decoration:underline;
}
.diff-plus{color:#ff3b30;font-weight:bold}
.diff-minus{color:#34c759;font-weight:bold}

/* ===== æ“ä½œ ===== */
.actions{display:flex;gap:8px;margin-bottom:8px}
.actions button{
 flex:1;padding:14px;border:none;border-radius:14px;
 font-size:18px;font-weight:bold;
}
.btn-main{background:var(--blue);color:#fff}
.btn-clear{background:var(--gray);color:#fff}

/* ===== éµç›¤ ===== */
.keypad{
 display:grid;grid-template-columns:repeat(3,1fr);
 gap:8px;
}
.keypad button{
 font-size:22px;padding:14px 0;
 border:none;border-radius:14px;
 background:#e5e5ea;
}
.keypad .delete{background:#ff3b30;color:#fff}
.keypad .action{background:var(--blue);color:#fff}
</style>
</head>

<body>
<div class="container">

<header>
 <h2 id="modeTitle">ğŸŠ æ–°å¢æˆç¸¾</h2>
 <div class="hint">é»æ“Šã€Œç¸½æ™‚é–“ã€å¯ä¿®æ­£æˆç¸¾</div>
</header>

<div class="time-box">
 <div id="min" class="time">00</div><span class="sep">:</span>
 <div id="sec" class="time">00</div><span class="sep">.</span>
 <div id="ms" class="time">00</div>
</div>

<div class="stopwatch">
 <button id="swStart" class="btn-blue">â–¶ é–‹å§‹</button>
 <button id="swPause" class="btn-orange">â¸ æš«åœ</button>
 <button id="swLap" class="btn-blue">â± åˆ†æ®µ</button>
 <button id="swStop" class="btn-gray">â¹ çµæŸ</button>
</div>

<div class="table-container">
<table>
<thead><tr>
<th>æ®µ</th><th>ç¸½æ™‚é–“</th><th>åˆ†æ®µ</th><th>ç§’å·®</th>
</tr></thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div class="actions">
 <button id="save" class="btn-main">âœ“ æ–°å¢ç´€éŒ„</button>
 <button id="clear" class="btn-clear">ğŸ—‘ æ¸…é™¤</button>
</div>

<div class="keypad">
 <button data="7">7</button><button data="8">8</button><button data="9">9</button>
 <button data="4">4</button><button data="5">5</button><button data="6">6</button>
 <button data="1">1</button><button data="2">2</button><button data="3">3</button>
 <button class="delete" data="del">âŒ«</button>
 <button data="0">0</button>
 <button class="action" data="save">âœ“</button>
</div>

</div>

<script>
const $=id=>document.getElementById(id);
const fields=["min","sec","ms"];
let idx=0,first=true;
let records=[];
let edit=null;

/* ===== è¼¸å…¥ ===== */
fields.forEach((f,i)=>$(f).onclick=()=>{idx=i;first=true;hi();});
function hi(){fields.forEach((f,i)=>$(f).classList.toggle("active",i===idx));}
hi();

/* ===== éµç›¤ ===== */
document.querySelectorAll(".keypad button").forEach(b=>{
 b.onclick=()=>{
  const v=b.getAttribute("data");
  if(v==="del") del();
  else if(v==="save") save();
  else input(v);
 };
});
function input(n){
 let f=$(fields[idx]);
 f.textContent=first?n:f.textContent+n;
 f.textContent=f.textContent.slice(-2);
 first=false;
 if(f.textContent.length===2){idx=Math.min(idx+1,2);first=true;}
 hi();
}
function del(){
 if($(fields[idx]).textContent!=="00") $(fields[idx]).textContent="00";
 else if(idx>0){idx--;$(fields[idx]).textContent="00";}
 first=true;hi();
}

/* ===== å­˜æª”ï¼ˆæ–°å¢ / ä¿®æ­£ï¼‰ ===== */
function save(){
 const t=+$("min").textContent*60
   + +$("sec").textContent
   + +$("ms").textContent/100;
 if(t<=0) return;

 if(edit){
  edit.total=t;
  edit=null;
  modeTitle.textContent="ğŸŠ æ–°å¢æˆç¸¾";
  save.textContent="âœ“ æ–°å¢ç´€éŒ„";
 }else{
  if(records.length>=30) return;
  records.push({total:t});
 }
 clearInput();
 render();
}

/* ===== æ¸…é™¤ ===== */
clear.onclick=()=>{
 edit=null;
 modeTitle.textContent="ğŸŠ æ–°å¢æˆç¸¾";
 save.textContent="âœ“ æ–°å¢ç´€éŒ„";
 records=[];
 clearInput();
 render();
};
function clearInput(){
 fields.forEach(f=>$(f).textContent="00");
 idx=0;first=true;hi();
}

/* ===== ç¢¼éŒ¶ ===== */
let run=false,start=0,el=0,raf=null;
function tick(){
 el=(performance.now()-start)/1000;
 setTime(el);raf=requestAnimationFrame(tick);
}
function setTime(t){
 min.textContent=String(Math.floor(t/60)).padStart(2,"0");
 sec.textContent=String(Math.floor(t%60)).padStart(2,"0");
 ms.textContent=String(Math.floor((t%1)*100)).padStart(2,"0");
}
swStart.onclick=()=>{if(run)return;run=true;start=performance.now()-el*1000;tick();}
swPause.onclick=()=>{run=false;cancelAnimationFrame(raf);}
swLap.onclick=()=>{if(run) save();}
swStop.onclick=()=>{run=false;cancelAnimationFrame(raf);}

/* ===== è¡¨æ ¼ ===== */
function render(){
 records.sort((a,b)=>a.total-b.total);
 tbody.innerHTML="";
 records.forEach((r,i)=>{
  const s=i?r.total-records[i-1].total:r.total;
  let d="-",c="";
  if(i>0){
   const p=i>1?records[i-1].total-records[i-2].total:records[i-1].total;
   const x=s-p;d=(x>0?"+":"")+x.toFixed(2);c=x>0?"diff-plus":"diff-minus";
  }
  const tr=document.createElement("tr");
  tr.innerHTML=`
   <td>${i+1}</td>
   <td class="time-cell">${fmt(r.total)}</td>
   <td>${fmt(s)}</td>
   <td class="${c}">${d}</td>`;
  tr.querySelector(".time-cell").onclick=()=>{
   edit=r;
   load(r);
   modeTitle.textContent="âœï¸ ä¿®æ­£æˆç¸¾ï¼ˆé» âœ“ æ›´æ–°ï¼‰";
   save.textContent="âœ“ æ›´æ–°ç´€éŒ„";
  };
  tbody.appendChild(tr);
 });
}
function load(r){
 min.textContent=String(Math.floor(r.total/60)).padStart(2,"0");
 sec.textContent=String(Math.floor(r.total%60)).padStart(2,"0");
 ms.textContent=String(Math.round((r.total%1)*100)).padStart(2,"0");
 idx=0;first=true;hi();
}
function fmt(s){
 const m=Math.floor(s/60);
 const ss=(s%60).toFixed(2).padStart(5,"0");
 return `${String(m).padStart(2,"0")}:${ss}`;
}
</script>

</body>
</html>
