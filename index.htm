<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é¸æ‰‹åˆ†æ®µç§’å·®è¨ˆç®—å™¨ 2026</title>
    <style>
        :root {
            --apple-blue: #0071e3;
            --apple-orange: #ff9500;
            --apple-gray: #8e8e93;
            --apple-bg: #f2f2f7;
        }

        html, body {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none;
            margin: 0;
            padding: 0;
            height: 100%;
            background: var(--apple-bg);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            justify-content: center;
        }

        /* é—œéµï¼šä½¿ç”¨ svh ç¢ºä¿ä¸è¢«ç€è¦½å™¨ç¶²å€åˆ—é®æ“‹ */
        .container {
            width: 100%;
            max-width: 500px;
            height: 100svh; 
            background: #fff;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            padding: 10px 15px env(safe-area-inset-bottom);
        }

        header { text-align: center; padding: 5px 0; }
        h2 { margin: 5px 0 2px 0; font-size: 18px; color: #1c1c1e; }
        .hint-text { font-size: 13px; color: var(--apple-blue); margin-bottom: 8px; font-weight: 500; }

        /* --- è¼¸å…¥é¡¯ç¤ºå€ --- */
        .input-section {
            background: #ffffff;
            padding: 8px;
            border-radius: 12px;
            border: 2px solid #e5e5ea;
            transition: all 0.3s ease;
            margin-bottom: 8px;
        }
        .input-section.editing-active { border-color: var(--apple-orange); background: #fff9f0; }
        
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 4px;
            background: var(--apple-gray);
            color: white;
        }
        .status-badge.edit { background: var(--apple-orange); }

        .time-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-variant-numeric: tabular-nums;
        }
        .time {
            width: 60px;
            text-align: center;
            border: 2px solid #d1d1d6;
            border-radius: 8px;
            padding: 4px;
            background: white;
        }
        .time.active { border-color: var(--apple-blue); background: #eef3ff; }
        .sep { margin: 0 4px; font-weight: bold; color: #aeaeb2; }

        /* --- ç´€éŒ„è¡¨æ ¼å€ (å½ˆæ€§ç¸®æ”¾) --- */
        .table-container {
            flex: 1; /* è‡ªå‹•å¡«æ»¿å‰©é¤˜ç©ºé–“ */
            overflow-y: auto;
            border: 1px solid #e5e5ea;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f9f9f9; color: #8e8e93; font-size: 12px; padding: 8px 5px; position: sticky; top: 0; z-index: 10; }
        td { padding: 10px 5px; text-align: center; border-bottom: 1px solid #f2f2f7; font-size: 14px; }
        
        .time-cell {
            font-size: 15px;
            font-weight: 600;
            color: var(--apple-blue);
            text-decoration: underline;
            cursor: pointer;
        }
        tr.is-editing { background-color: #fff9f0 !important; }
        tr.is-editing .time-cell { color: var(--apple-orange); }

        .diff-plus { color: #ff3b30; font-weight: bold; }
        .diff-minus { color: #34c759; font-weight: bold; }

        /* --- æŒ‰éˆ•èˆ‡éµç›¤å€ (å›ºå®šåœ¨åº•éƒ¨) --- */
        .actions { display: flex; gap: 8px; margin-bottom: 8px; }
        .actions button {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            font-size: 15px; font-weight: bold;
        }
        .btn-main { background: var(--apple-blue); color: #fff; }
        .btn-main.is-edit { background: var(--apple-orange); }
        .btn-clear { background: var(--apple-gray); color: #fff; }

        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .keypad button {
            font-size: 24px; padding: 12px 0; border: none; border-radius: 10px;
            background: #e5e5ea; color: #1c1c1e; font-weight: 500;
        }
        .keypad button:active { background: #c7c7cc; }
        .keypad .action { background: var(--apple-blue); color: #fff; }
        .keypad .delete { background: #ff3b30; color: #fff; }
    </style>
</head>

<body>
<div class="container">
    <header>
        <h2>ğŸŠ åˆ†æ®µç§’å·®è¨ˆç®—å™¨</h2>
        <div class="hint-text">ğŸ’¡ è‹¥è¦ä¿®æ­£ç§’æ•¸ï¼Œè«‹ç›´æ¥é»æ“Šè¡¨æ ¼ä¸­çš„ç¸½æ™‚é–“</div>
    </header>

    <div class="input-section" id="input-ui">
        <div id="status-badge" class="status-badge">æ–°å¢æ¨¡å¼</div>
        <div class="time-box">
            <div id="min" class="time">00</div><span class="sep">:</span>
            <div id="sec" class="time">00</div><span class="sep">.</span>
            <div id="ms" class="time">00</div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>æ®µæ¬¡</th>
                    <th>ç¸½æ™‚é–“ (ä¿®æ­£)</th>
                    <th>åˆ†æ®µ</th>
                    <th>ç§’å·®</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <div class="actions">
        <button class="btn-main" id="btn-save">âœ“ æ–°å¢ç´€éŒ„</button>
        <button class="btn-clear" id="btn-clear">ğŸ—‘ æ¸…é™¤</button>
    </div>

    <div class="keypad" id="keypad">
        <button data-val="7">7</button><button data-val="8">8</button><button data-val="9">9</button>
        <button data-val="4">4</button><button data-val="5">5</button><button data-val="6">6</button>
        <button data-val="1">1</button><button data-val="2">2</button><button data-val="3">3</button>
        <button class="delete" data-val="del">âŒ«</button><button data-val="0">0</button><button class="action" data-val="save">âœ“</button>
    </div>
</div>

<script>
const fields = ["min", "sec", "ms"];
let currentIdx = 1; // é è¨­èšç„¦åœ¨ã€Œç§’ã€
let records = [];
let editingId = null;

const tbody = document.getElementById("tbody");
const btnSave = document.getElementById('btn-save');
const inputUI = document.getElementById('input-ui');
const statusBadge = document.getElementById('status-badge');

function bind(el, cb) {
    el.addEventListener('touchstart', (e) => { e.preventDefault(); cb(); }, { passive: false });
    el.addEventListener('click', cb);
}

fields.forEach((id, idx) => {
    bind(document.getElementById(id), () => { currentIdx = idx; highlight(); });
});

document.querySelectorAll('#keypad button').forEach(btn => {
    bind(btn, () => {
        const val = btn.getAttribute('data-val');
        if (val === 'del') backspace();
        else if (val === 'save') saveRecord();
        else inputNum(val);
    });
});

bind(btnSave, saveRecord);
bind(document.getElementById('btn-clear'), clearAll);

function highlight() {
    fields.forEach(id => document.getElementById(id).classList.remove("active"));
    document.getElementById(fields[currentIdx]).classList.add("active");
}

function inputNum(n) {
    let f = document.getElementById(fields[currentIdx]);
    if (f.textContent === "00") f.textContent = "";
    if (f.textContent.length < 2) {
        f.textContent += n;
        if (f.textContent.length === 2 && currentIdx < 2) {
            currentIdx++;
            highlight();
        }
    }
}

function backspace() {
    let f = document.getElementById(fields[currentIdx]);
    if (f.textContent !== "00" && f.textContent.length > 0) {
        f.textContent = f.textContent.slice(0, -1);
        if (f.textContent === "") f.textContent = "00";
    } else if (currentIdx > 0) {
        currentIdx--;
        highlight();
    }
}

function saveRecord() {
    const total = (parseInt(document.getElementById("min").textContent) * 60) + 
                  (parseInt(document.getElementById("sec").textContent)) + 
                  (parseInt(document.getElementById("ms").textContent) / 100);
    if (total === 0) return;

    if (editingId !== null) {
        const item = records.find(r => r.id === editingId);
        if (item) item.total = total;
        exitEditMode();
    } else {
        records.push({ id: Date.now(), total: total });
    }

    refreshUI();
    clearInput();
}

function refreshUI() {
    records.sort((a, b) => a.total - b.total);
    tbody.innerHTML = "";
    records.forEach((r, i) => {
        r.split = (i === 0) ? r.total : r.total - records[i - 1].total;
        let diff = "-", cls = "";
        if (i > 0) {
            let d = r.split - records[i - 1].split;
            diff = (d > 0 ? "+" : "") + d.toFixed(2) + "s";
            cls = d > 0 ? "diff-plus" : "diff-minus";
        }
        const tr = document.createElement("tr");
        if (editingId === r.id) tr.className = "is-editing";
        tr.innerHTML = `<td>${i + 1}</td><td class="time-cell">${format(r.total)}</td><td>${format(r.split)}</td><td class="${cls}">${diff}</td>`;
        bind(tr.querySelector('.time-cell'), () => enterEditMode(r));
        tbody.appendChild(tr);
    });
}

function enterEditMode(record) {
    editingId = record.id;
    const m = Math.floor(record.total / 60);
    const s = Math.floor(record.total % 60);
    const ms = Math.round((record.total % 1) * 100);
    document.getElementById("min").textContent = m.toString().padStart(2, "0");
    document.getElementById("sec").textContent = s.toString().padStart(2, "0");
    document.getElementById("ms").textContent = ms.toString().padStart(2, "0");
    statusBadge.textContent = "ç·¨è¼¯æ¨¡å¼";
    statusBadge.classList.add("edit");
    inputUI.classList.add("editing-active");
    btnSave.textContent = "ğŸ’¾ å„²å­˜ä¿®æ”¹";
    btnSave.classList.add("is-edit");
    currentIdx = 1;
    highlight();
    refreshUI();
}

function exitEditMode() {
    editingId = null;
    statusBadge.textContent = "æ–°å¢æ¨¡å¼";
    statusBadge.classList.remove("edit");
    inputUI.classList.remove("editing-active");
    btnSave.textContent = "âœ“ æ–°å¢ç´€éŒ„";
    btnSave.classList.remove("is-edit");
}

function format(sec) {
    let m = Math.floor(sec / 60);
    let s = (sec % 60).toFixed(2);
    return `${m.toString().padStart(2, "0")}:${s.padStart(5, "0")}`;
}

function clearInput() {
    fields.forEach(id => document.getElementById(id).textContent = "00");
    currentIdx = 1;
    highlight();
}

function clearAll() {
    if (confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
        records = [];
        exitEditMode();
        refreshUI();
        clearInput();
    }
}
highlight();
</script>
</body>
</html>
