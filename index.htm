<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¸æ‰‹åˆ†æ®µç§’å·®è¨ˆç®—å™¨ 2026</title>
    <style>
        html, body {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            overscroll-behavior: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f7;
            padding: 10px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: #fff;
            padding: 15px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,.08);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* --- 1. è¼¸å…¥å€åŸŸ (ç¸®å°) --- */
        .input-section {
            background: #f9f9fb;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #eee;
        }
        .input-label {
            text-align: center;
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        .time-box {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px; /* ç¸®å°è¼¸å…¥æ–‡å­— */
            font-variant-numeric: tabular-nums;
        }
        .time {
            width: 55px; /* ç¸®å°æ ¼å­ */
            text-align: center;
            border: 1.5px solid #ccc;
            border-radius: 8px;
            padding: 4px;
            background: white;
        }
        .time.active {
            border-color: #0071e3;
            background: #eef3ff;
        }
        .sep { margin: 0 3px; font-weight: bold; color: #86868b; }

        /* --- 2. ç´€éŒ„è¡¨æ ¼å€åŸŸ (æ”¾å¤§æ™‚é–“é¡¯ç¤º) --- */
        .table-container {
            flex-grow: 1;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td {
            padding: 12px 8px; /* å¢åŠ é–“è· */
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        td.time-cell {
            font-size: 17px; /* æ”¾å¤§é¡¯ç¤ºæ™‚é–“ */
            font-weight: 500;
            color: #0071e3;
            text-decoration: underline; /* æç¤ºå¯é»æ“Šä¿®æ”¹ */
        }
        th { background: #fafafa; color: #888; position: sticky; top: 0; }

        .diff-plus { color: #d70015; font-weight: bold; }
        .diff-minus { color: #008026; font-weight: bold; }

        /* --- 3. ä¸‹æ–¹æ“ä½œå€ --- */
        .actions { display: flex; gap: 8px; margin-bottom: 10px; }
        .actions button {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            font-size: 15px; font-weight: bold; cursor: pointer;
        }
        .add { background: #0071e3; color: #fff; }
        .editing-mode { background: #ff9500 !important; } /* ç·¨è¼¯æ¨¡å¼è®Šè‰² */
        .clear-all { background: #86868b; color: #fff; }

        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .keypad button {
            font-size: 24px; padding: 15px 0; border: none; border-radius: 12px;
            background: #f2f2f7; color: #1d1d1f; font-weight: 500;
        }
        .keypad button:active { background: #d1d1d6; }
        .keypad .action { background: #0071e3; color: #fff; }
        .keypad .delete { background: #ff3b30; color: #fff; }
    </style>
</head>

<body>
<div class="container">
    <h2 id="title">ğŸŠ åˆ†æ®µç§’å·®è¨ˆç®—å™¨</h2>

    <div class="input-section">
        <div class="input-label" id="edit-status">è¼¸å…¥æ–°æˆç¸¾æˆ–é»æ“Šä¸‹æ–¹æ™‚é–“ä¿®æ”¹</div>
        <div class="time-box">
            <div id="min" class="time">00</div><span class="sep">:</span>
            <div id="sec" class="time">00</div><span class="sep">.</span>
            <div id="ms" class="time">00</div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>æ®µæ¬¡</th>
                    <th>ç¸½æ™‚é–“</th>
                    <th>åˆ†æ®µ</th>
                    <th>ç§’å·®</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <div class="actions">
        <button class="add" id="btn-add">âœ“ æ–°å¢ç´€éŒ„</button>
        <button class="clear-all" id="btn-clear">ğŸ—‘ æ¸…é™¤</button>
    </div>

    <div class="keypad" id="keypad">
        <button data-val="7">7</button><button data-val="8">8</button><button data-val="9">9</button>
        <button data-val="4">4</button><button data-val="5">5</button><button data-val="6">6</button>
        <button data-val="1">1</button><button data-val="2">2</button><button data-val="3">3</button>
        <button class="delete" data-val="del">âŒ«</button><button data-val="0">0</button><button class="action" data-val="add">âœ“</button>
    </div>
</div>

<script>
const fields = ["min", "sec", "ms"];
let currentFieldIdx = 0;
let records = [];
let editingIndex = -1; // -1 è¡¨ç¤ºæ–°å¢æ¨¡å¼ï¼Œ>=0 è¡¨ç¤ºä¿®æ”¹æ¨¡å¼

const tbody = document.getElementById("tbody");
const btnAdd = document.getElementById('btn-add');
const editStatus = document.getElementById('edit-status');

function bindFastClick(el, callback) {
    el.addEventListener('touchstart', (e) => { e.preventDefault(); callback(); }, { passive: false });
    el.addEventListener('click', callback);
}

// åˆå§‹åŒ–æ¬„ä½åˆ‡æ›
fields.forEach((id, idx) => {
    bindFastClick(document.getElementById(id), () => { currentFieldIdx = idx; highlight(); });
});

// åˆå§‹åŒ–éµç›¤
document.querySelectorAll('#keypad button').forEach(btn => {
    bindFastClick(btn, () => {
        const val = btn.getAttribute('data-val');
        if (val === 'del') backspace();
        else if (val === 'add') saveRecord();
        else inputNum(val);
    });
});

bindFastClick(btnAdd, saveRecord);
bindFastClick(document.getElementById('btn-clear'), clearAll);

function highlight() {
    fields.forEach(id => document.getElementById(id).classList.remove("active"));
    document.getElementById(fields[currentFieldIdx]).classList.add("active");
}

function inputNum(n) {
    let f = document.getElementById(fields[currentFieldIdx]);
    if (f.textContent === "00") f.textContent = "";
    if (f.textContent.length < 2) {
        f.textContent += n;
        if (f.textContent.length === 2 && currentFieldIdx < 2) {
            currentFieldIdx++;
            highlight();
        }
    }
}

function backspace() {
    let f = document.getElementById(fields[currentFieldIdx]);
    if (f.textContent !== "00" && f.textContent.length > 0) {
        f.textContent = f.textContent.slice(0, -1);
        if (f.textContent === "") f.textContent = "00";
    } else if (currentFieldIdx > 0) {
        currentFieldIdx--;
        highlight();
    }
}

function saveRecord() {
    const total = (parseInt(document.getElementById("min").textContent) * 60) + 
                  (parseInt(document.getElementById("sec").textContent)) + 
                  (parseInt(document.getElementById("ms").textContent) / 100);
    if (total === 0) return;

    if (editingIndex > -1) {
        // ä¿®æ”¹æ¨¡å¼
        records[editingIndex].total = total;
        editingIndex = -1;
        btnAdd.textContent = "âœ“ æ–°å¢ç´€éŒ„";
        btnAdd.classList.remove("editing-mode");
        editStatus.textContent = "ä¿®æ”¹å®Œæˆ";
        editStatus.style.color = "#008026";
    } else {
        // æ–°å¢æ¨¡å¼
        if (records.length > 0 && total <= records[records.length-1].total) {
            alert("ç¸½æ™‚é–“å¿…é ˆå¤§æ–¼å‰ä¸€ç­†ï¼"); return;
        }
        records.push({ total: total });
    }

    reCalculateAndUI();
    clearInput();
}

// æ ¸å¿ƒé‚è¼¯ï¼šé‡æ–°è¨ˆç®—æ‰€æœ‰åˆ†æ®µèˆ‡ç§’å·®ä¸¦åˆ·æ–°ä»‹é¢
function reCalculateAndUI() {
    // ä¾ç¸½æ™‚é–“æ­£åºæ’åºï¼Œç¢ºä¿é‚è¼¯æ­£ç¢º
    records.sort((a, b) => a.total - b.total);

    tbody.innerHTML = "";
    records.forEach((r, i) => {
        // è¨ˆç®—åˆ†æ®µ
        r.split = (i === 0) ? r.total : r.total - records[i - 1].total;
        
        // è¨ˆç®—ç§’å·® (æœ¬æ®µåˆ†æ®µ - å‰æ®µåˆ†æ®µ)
        let diff = "-", cls = "";
        if (i > 0) {
            let d = r.split - records[i - 1].split;
            diff = (d > 0 ? "+" : "") + d.toFixed(2) + "s";
            cls = d > 0 ? "diff-plus" : "diff-minus";
        }

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${i + 1}</td>
            <td class="time-cell">${formatTime(r.total)}</td>
            <td>${formatTime(r.split)}</td>
            <td class="${cls}">${diff}</td>
        `;
        
        // é»æ“Šç¸½æ™‚é–“é€²å…¥ç·¨è¼¯æ¨¡å¼
        bindFastClick(row.querySelector('.time-cell'), () => startEdit(i));
        
        tbody.appendChild(row); // æ­£åºæ’åˆ—ï¼šç›´æ¥ appendChild
    });
}

function startEdit(index) {
    editingIndex = index;
    const r = records[index];
    const m = Math.floor(r.total / 60);
    const s = Math.floor(r.total % 60);
    const ms = Math.round((r.total % 1) * 100);

    document.getElementById("min").textContent = m.toString().padStart(2, "0");
    document.getElementById("sec").textContent = s.toString().padStart(2, "0");
    document.getElementById("ms").textContent = ms.toString().padStart(2, "0");

    btnAdd.textContent = "ğŸ’¾ ç¢ºèªä¿®æ”¹";
    btnAdd.classList.add("editing-mode");
    editStatus.textContent = `æ­£åœ¨ä¿®æ”¹ç¬¬ ${index + 1} æ®µ`;
    editStatus.style.color = "#ff9500";
    currentFieldIdx = 0;
    highlight();
}

function formatTime(sec) {
    let m = Math.floor(sec / 60);
    let s = (sec % 60).toFixed(2);
    return `${m.toString().padStart(2, "0")}:${s.padStart(5, "0")}`;
}

function clearInput() {
    fields.forEach(id => document.getElementById(id).textContent = "00");
    currentFieldIdx = 0;
    highlight();
}

function clearAll() {
    if (confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
        records = [];
        editingIndex = -1;
        btnAdd.textContent = "âœ“ æ–°å¢ç´€éŒ„";
        btnAdd.classList.remove("editing-mode");
        tbody.innerHTML = "";
        clearInput();
    }
}

highlight();
</script>
</body>
</html>
